# HTTP/3 and QUIC Configuration
http2 on;
http3 on;
quic_gso on;
quic_retry on;

# Unlimited upload size
client_max_body_size 0;

# SSL/TLS Configuration
ssl_dyn_rec_enable on;
ssl_session_timeout 1d;
ssl_session_cache shared:HTTPS:10m;
ssl_protocols TLSv1.2 TLSv1.3;
ssl_prefer_server_ciphers on;
ssl_ciphers TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305;

# Performance optimizations
sendfile on;
tcp_nopush on;
tcp_nodelay on;
keepalive_timeout 65;

# Compression
gzip on;
gzip_vary on;
gzip_comp_level 6;
gzip_types text/plain text/css text/xml text/javascript application/json application/javascript application/xml+rss application/rss+xml font/truetype font/opentype application/vnd.ms-fontobject image/svg+xml;

# Security headers
server_tokens off;
add_header X-Content-Type-Options "nosniff" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Proxy settings
proxy_buffering on;
proxy_buffer_size 32k;
proxy_buffers 64 16k;
proxy_busy_buffers_size 256k;
proxy_read_timeout 86400s;
proxy_socket_keepalive on;
proxy_http_version 1.1;

# WebSocket support
map $http_upgrade $connection_upgrade {
    default upgrade;
    '' close;
}

# Include default server configuration
include /data/nginx/default.conf;

